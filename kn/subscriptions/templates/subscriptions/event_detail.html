{% extends "leden/base.html" %}
{% load base %}

{% block styles %}
{{ block.super }}
<link rel="stylesheet" href="{{ MEDIA_URL }}subscriptions/event_detail.css" />
{% endblock styles %}

{% block head %}
{{ block.super }}
<script>
var events_api_url = '{% url "api" %}';
var event_object_id = '{{ object.id }}';
</script>
<script src="{{ MEDIA_URL }}subscriptions/event_detail.js"></script>
{% endblock %}

{% block body %}
<h1>{{ object.humanName }}</h1>
<div id="subscription-description">
{{ object.description_html|safe }}
</div>
<dl>
    {% if object.date %}
    <dt>Datum</dt>
    <dd>{{ object.date.date }}</dd>
    {% endif %}{# object.date #}
    {% if object.owner %}
    <dt>Georganiseerd door</dt>
    <dd><a href="{{ object.owner.get_absolute_url }}"
        >{{ object.owner.humanName }}</a></dd>
    {% endif %}
    {% if object.createdBy and object.createdBy != object.owner %}
    <dt>Activiteit gemaakt door</dt>
    <dd><a href="{{ object.createdBy.get_absolute_url }}"
        >{{ object.createdBy.humanName }}</a></dd>
    {% endif %}
    {% if object.max_subscriptions != None %}
    <dt>Maximum aantal deelnemers:</dt>
    <dd>{{ object.max_subscriptions }} personen</dd>
    {% endif %}
    {% if object.cost %}
    <dt>Kosten</dt>
    <dd>&euro; {{ object.cost }}</dd>
    {% endif %}
</dl>

{% if object.history %}
Geschiedenis:
<ul>
    {% for historyEvent in object.history %}
    <li>Activiteit
        {% if historyEvent.action == 'opened' %}geopend
        {% elif historyEvent.action == 'closed' %}gesloten
        {% elif historyEvent.action == 'edited' %}bewerkt
        {% endif %}
        op {{ historyEvent.date.date }}
        door <a href="{{ historyEvent.user.get_absolute_url }}"
                                   >{{ historyEvent.user.humanName }}</a>.</li>
    {% endfor %}
</ul>
{% endif %}


{% if object.is_open %}
<div class="tabs">
    <div class="tabHeads">
        <div class="tabHead {% if not subscription.subscribed %} selected{% endif %}"
            data-for="tab-subscribe">Aanmelden</div>
        <div class="tabHead {% if subscription.subscribed %} selected{% endif %}"
            data-for="tab-invite">Uitnodigen</div>
    </div>
    <div class="tabBody" id="tab-subscribe">
        <form class="subscribe" method="POST" action="">
            {% csrf_token %}
            {% if subscription.subscribed and object.can_unsubscribe %}
            <div class="message"><strong>Je bent al aangemeld</strong>, maar je
                kunt je nog afmelden.</div>
            {% elif subscription.invited and not subscription.has_mutations %}
            <div class="message">Je bent door
            <a href="{{ subscription.inviter.get_absolute_url }}"
                >{{ subscription.inviter.full_name }}</a>
            uitgenodigd.</div>
            {% endif %}

            {% if object.can_subscribe and not subscription.subscribed or object.can_unsubscribe and not subscription.unsubscribed %}
            <!--[if lte IE 9]>
            Opmerkingen:<br/>
            <![endif]-->
            <textarea class="default" name="notes" cols="30" rows="4"
                placeholder="Opmerkingen"></textarea>
            {% if subscription.subscribed %}
            <input type="submit" name="unsubscribe" value="Afmelden"/><br/>
            {% else %}
            <input type="submit" name="subscribe" value="Aanmelden"/><br/>
            {% if not object.may_unsubscribe %}
            (je kunt je daarna niet meer afmelden)<br/>
            {% endif %}{# object.may_unsubscribe #}
            {% endif %}{# subscription.subscribed #}
            {% else %}
            {% if not object.is_open %}
            De activiteit is gesloten, je kunt je niet meer aanmelden of
            afmelden.
            {% else %}
            Je kunt je helaas niet meer aanmelden{% if object.may_unsubscribe %}
                of afmelden{% endif %}.<br/>
            {% endif %}{# object.is_open #}
            Stuur een mailtje naar <a href="mailto:{{ object.owner.canonical_email }}"
                >{{ object.owner.canonical_email }}</a> voor vragen.
            {% endif %}{# object.can_subscribe #}
        </form>
    </div>

    <div class="tabBody" id="tab-invite">
        <form class="subscribe" method="POST" action="">
            {% csrf_token %}
            <!--[if lte IE 9]>
            Opmerkingen:<br/>
            <![endif]-->
            <textarea class="default" name="notes" cols="30" rows="4"
                placeholder="Opmerkingen"></textarea>
            {% if not object.can_subscribe %}
            <div class="message">Let op: je kunt je niet meer aanmelden!</div>
            {% endif %}{# object.can_subscribe #}
            <select name="who" required>
                <option selected disabled hidden value=""></option>
                {% for u in users %}
                <option value="{{ u.id }}">{{ u.full_name }}</option>
                {% endfor %}{# u in users #}
            </select>
            <input type="submit" name="invite" value="Uitnodigen" />
        </form>
    </div>
</div>
{% endif %}{# object.is_open #}

{% if has_write_access %}
<div>
    {% if object.is_open %}
    <button onclick="close_event()">Sluit inschrijvingen</button>
    {% else %}
    <button onclick="reopen_event()">Heropen inschrijvingen</button>
    {% endif %}{# object.is_open #}
    â€“ <a href="{% url "event-edit" edit=object.name %}">Bewerk activiteit</a>
</div>
{% endif %}{# has_write_access #}

{% if has_read_access or object.has_public_subscriptions %}
    <button onclick="copy_emailaddresses_to_clipboard()">
        Toon e-mail adressen van de ingeschrevenen
    </button>
    {% if listSubscribed %}
    <h2>Aanmeldingen ({{ listSubscribed|length }})</h2>
    {% include "subscriptions/include_list.html" with list=listSubscribed %}
    {% else %}
    <p>Er zijn (nog) geen aanmeldingen.</p>
    {% endif %}{# listSubscribed #}

    {% if listUnsubscribed %}
    <h2>Afmeldingen ({{ listUnsubscribed|length }})</h2>
    {% include "subscriptions/include_list.html" with list=listUnsubscribed %}
    {% endif %}{# listUnsubscribed #}

    {% if listInvited %}
    <h2>Uitnodigingen ({{ listInvited|length }})</h2>
    {% include "subscriptions/include_list.html" with list=listInvited %}
    {% endif %}{# listInvited #}
{% endif %}{# has_read_access or object.has_public_subscriptions#}
{% endblock %}
